import json
import os
from flask import Flask, request
app = Flask(__name__)

@app.route("/")
def hello():
    return "Server is working!"

@app.route("/enter",methods=['POST'] )
def enter():
    if 'face' not in request.files:
        print "No image file received in enter() ['POST']"
        return 'No image file received!'
    image_file = request.files.get('face', '')
    customer_id = str(len(os.listdir('database')) + 1)
    os.makedirs('database/'+customer_id)
    with open('database/'+ customer_id+'/face.jpg','w') as file:
        image_file.save(file)
    customer_dict = {'weight' : request.values.get('weight')}
    customer_dict['id'] = customer_id
    with open('database/'+ customer_id+'/parameters.json','w') as file:
        json.dump(customer_dict, file)
    return 'Saved new customer'

if __name__ == "__main__":
    app.run()
