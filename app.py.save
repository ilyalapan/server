import json
import os
import flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Server is working!"

@app.route("/enter",methods=['POST'] )
def enter():
    image_file = flask.request.files.get('face', '')
    if image_file is None:
        print "No image file received in enter['POST']"
        return 'No image file received!'
    customer_id = len(os.listdir('database')) + 1
    os.makedirs('database/'+ customer_id)
    with open('database/'+ customer_id+'/face.jpg','w') as file:
        image_file.save(file)
    customer_dict = {'weight' : request.values.get('weight')}
    customer_dict['id'] = customer_id
    json.dump(customer_dict, 'database/'+ customer_id+'/parameters.json')
    return 'Saved new customer'

if __name__ == "__main__":
    app.run()
